#:kivy 1.11.0
#:import Factory kivy.factory.Factory
#:import FadeTransition kivy.uix.screenmanager.FadeTransition
#:import Serveur reseau.Serveur


<BackgroundColor@Widget>
    background_color: 1, 1, 1, 1
    canvas.before:
        Color:
            hsv: root.background_color
        Rectangle:
            size: self.size
            pos: self.pos

<SuperLabel@Label+BackgroundColor>
    background_color: 0, 0, 0, 0

<SuperScreen@Screen+BackgroundColor>
    background_color: 0, 0, 0, 0

<SBoxLayout@BoxLayout+BackgroundColor>
    background_color: 0, 0, 0, 0

<SImage@Image+BackgroundColor>
    background_color: 0, 0, 0, 0



<QuitConfirmationPopup@Popup>:
    size_hint: 0.4, 0.2
    title: "Steuplaît reste... "
    BoxLayout:
        Button:
            text: "Bon, d'accord..."
            on_release: root.dismiss()
        Button:
            text: "NAN !!"
            on_release: app.stop()

<InformationsDeConnexionPopup@Popup>:
    size_hint: 0.4, 0.3
    title: "Connexion"
    adresseInput: adresse
    BoxLayout:
        orientation: 'vertical'
        NumericalInput:
            id: adresse
            focus: True
            multiline: False
            write_tab: False
            keyboon_key_down: None
            hint_text: "adresse"
            on_text_validate: port.focus = True
        NumericalInput:
            id: port
            maxLength: 5
            multiline: False
            write_tab: False
            hint_text: "port"
            on_text_validate: app.client.adresseCible = adresse.text; app.client.portCible = int(port.text);  app.serveur_to_client(); root.dismiss()
        Button:
            text: "Se connecter"
            on_release: app.client.adresseCible = adresse.text; app.client.portCible = int(port.text);  app.serveur_to_client(); root.dismiss()


<Chat>:
    orientation: 'vertical'
    messages: messages
    MessageHistoric:
        id: messages
        halign: "left"
        valign: "bottom"
        text_size: self.size
        padding: 5, 2
    ChatTextInput:
        size_hint_y: None
        hint_text: "Envoyer un message"
        height: self.minimum_height
        multiline: False
        text_validate_unfocus: False
        on_text_validate: if self.text: app.send(self.text); messages.add(self.text); self.text = "";


<SuperSettings>:
    size_hint: 0.8, 0.6

<MultiplayerScreen@SuperScreen+MouseEvents>:
    name: 'multiplayer'
    on_pre_enter: app.serveur.start(); app.messagesHistoric = chat.messages; titre.text = 'Héberger'


    BoxLayout:
        orientation: 'vertical'
        SBoxLayout:
            background_color: 0.627,0.7,0.7,1
            size_hint: 1, 0.1

            canvas:
                Color:
                    hsv: 0, 0,0.7,1
                Rectangle:
                    size: root.width, root.height * 0.0005
                    pos: self.pos
            Label:
                id: titre
                text: 'Héberger'
                color: 0.9,0.9,0.9, 1
                outline_color: 0.6,0.6,0.9
                outline_width: 0.5
                halign: 'left'
                valign: 'middle'
                text_size: self.size
                padding: 10, 0
                font_size: min(self.size[0]/6, self.size[1]/2)
            BoxLayout:
                id: middle_section
                padding: 5,5,5,5
                spacing: 10
                size_hint_x: 0.5
                Button:
                    text: 'Ajouter IA'
                Button:
                    text: 'Rejoindre'
                    on_release: Factory.InformationsDeConnexionPopup().open(); chat.messages.text = ""; titre.text = "Rejoindre"
        SBoxLayout:
            background_color: 0.627, 0.7, 0.3, 1
            canvas.before:
                Color:
                    hsv: 0.627, 0.6,0.7,1
                Rectangle:
                    size: root.width, root.height * 0.0005
                    pos: self.pos
            BoxLayout:
                orientation: 'vertical'
                Label:
                    text: 'PROFIL'
                Label:
                    text: 'VIDE'
                Label:
                    text: 'VIDE'
            BoxLayout:
                orientation: 'vertical'
                Label:
                    text: 'Règles'
        SBoxLayout:
            background_color: 0.627, 0.7, 0.2, 1
            size_hint: 1, 0.3
            Chat:
                id: chat
            Image:
                size_hint: None, None
                size: 3/2* chat.height, chat.height
                source: "images/blue_flower.jpeg"


<MyScreenManager>:
    transition: FadeTransition()
    MainScreen:
    MultiplayerScreen:
        right_click: root.to_last


<MainScreen>:
    name: 'main'

    BoxLayout:
        pos: root.width * 0.5 - self.width / 2, root.height * 0.5 - self.height / 2
        size_hint: 0.4, 0.6
        orientation: 'vertical'

        Button:
            text: "UN JOUEUR"
            on_release: app.lance_partie(1)
        Button:
            text: "MULTIJOUEUR"
            on_release: app.root.current = 'multiplayer'
        Button:
            text: "PARAMÈTRES"
            on_release: app.open_settings()
        Button:
            text: "QUITTER"
            on_release: Factory.QuitConfirmationPopup().open()

